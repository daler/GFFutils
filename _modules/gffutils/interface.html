<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gffutils.interface &mdash; gffutils 0.11.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> gffutils
          </a>
              <div class="version">
                0.11.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../database-import.html">Importing data into a database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../database-schema.html">Database schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../database-ids.html">Database IDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gtf.html">GTF files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dialect.html">Dialects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../attributes.html">Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers.html">Developerâ€™s docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../meta.html">Meta-docs (docs about the docs)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">gffutils</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>gffutils.interface</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for gffutils.interface</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">gffutils</span> <span class="kn">import</span> <span class="n">bins</span>
<span class="kn">from</span> <span class="nn">gffutils</span> <span class="kn">import</span> <span class="n">helpers</span>
<span class="kn">from</span> <span class="nn">gffutils</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">gffutils</span> <span class="kn">import</span> <span class="n">merge_criteria</span> <span class="k">as</span> <span class="n">mc</span>
<span class="kn">from</span> <span class="nn">gffutils.feature</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">from</span> <span class="nn">gffutils.exceptions</span> <span class="kn">import</span> <span class="n">FeatureNotFoundError</span>


<span class="k">def</span> <span class="nf">assign_child</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper for add_relation()</span>
<span class="sd">    Sets &#39;Parent&#39; attribute to parent[&#39;ID&#39;]</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    parent : Feature</span>
<span class="sd">        Parent Feature</span>

<span class="sd">    :param parent: parent Feature</span>

<span class="sd">    child : Feature</span>
<span class="sd">        Child Feature</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Child Feature</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">child</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;Parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">child</span>


<span class="c1"># Reusable constant for FeatureDB.merge()</span>
<span class="n">no_children</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_finalize_merge</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">feature_children</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper for FeatureDB.merge() to update source and assign children property</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    feature : Feature</span>
<span class="sd">        feature to finalise</span>

<span class="sd">    feature_children</span>
<span class="sd">        list of children to assign</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    feature, modified</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">feature</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">source</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">feature_children</span><span class="p">))</span>
        <span class="n">feature</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">feature_children</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">no_children</span>
    <span class="k">return</span> <span class="n">feature</span>


<div class="viewcode-block" id="FeatureDB"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.html#gffutils.interface.FeatureDB">[docs]</a><span class="k">class</span> <span class="nc">FeatureDB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># docstring to be filled in for methods that call out to</span>
    <span class="c1"># helpers.make_query()</span>
    <span class="n">_method_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        limit : string or tuple</span>
<span class="s2">            Limit the results to a genomic region.  If string, then of the form</span>
<span class="s2">            &quot;seqid:start-end&quot;; if tuple, then (seqid, start, end).</span>

<span class="s2">        strand : &quot;-&quot; | &quot;+&quot; | &quot;.&quot;</span>
<span class="s2">            Limit the results to one strand</span>

<span class="s2">        featuretype : string or tuple</span>
<span class="s2">            Limit the results to one or several featuretypes.</span>

<span class="s2">        order_by : string or tuple</span>
<span class="s2">            Order results by one or many fields; the string or tuple items must</span>
<span class="s2">            be in: &#39;seqid&#39;, &#39;source&#39;, &#39;featuretype&#39;, &#39;start&#39;, &#39;end&#39;, &#39;score&#39;,</span>
<span class="s2">            &#39;strand&#39;, &#39;frame&#39;, &#39;attributes&#39;, &#39;extra&#39;.</span>

<span class="s2">        reverse : bool</span>
<span class="s2">            Change sort order; only relevant if `order_by` is not None.  By</span>
<span class="s2">            default, results will be in ascending order, so use `reverse=True`</span>
<span class="s2">            for descending.</span>

<span class="s2">        completely_within : bool</span>
<span class="s2">            If False (default), a single bp overlap with `limit` is sufficient</span>
<span class="s2">            to return a feature; if True, then the feature must be completely</span>
<span class="s2">            within `limit`. Only relevant when `limit` is not None.</span>
<span class="s2">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FeatureDB.__init__"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.html#gffutils.interface.FeatureDB.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dbfn</span><span class="p">,</span>
        <span class="n">default_encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
        <span class="n">keep_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">pragmas</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">default_pragmas</span><span class="p">,</span>
        <span class="n">sort_attribute_values</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">text_factory</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">OptimizedUnicode</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect to a database created by :func:`gffutils.create_db`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        dbfn : str</span>

<span class="sd">            Path to a database created by :func:`gffutils.create_db`.</span>

<span class="sd">        text_factory : callable</span>

<span class="sd">            Optionally set the way sqlite3 handles strings.  Default is</span>
<span class="sd">            sqlite3.OptimizedUnicode, which returns ascii when possible,</span>
<span class="sd">            unicode otherwise</span>

<span class="sd">        default_encoding : str</span>

<span class="sd">            When non-ASCII characters are encountered, assume they are in this</span>
<span class="sd">            encoding.</span>

<span class="sd">        keep_order : bool</span>

<span class="sd">            If True, all features returned from this instance will have the</span>
<span class="sd">            order of their attributes maintained.  This can be turned on or off</span>
<span class="sd">            database-wide by setting the `keep_order` attribute or with this</span>
<span class="sd">            kwarg, or on a feature-by-feature basis by setting the `keep_order`</span>
<span class="sd">            attribute of an individual feature.</span>

<span class="sd">            Default is False, since this includes a sorting step that can get</span>
<span class="sd">            time-consuming for many features.</span>

<span class="sd">        sort_attributes_values : bool</span>
<span class="sd">            If True, then in cases where there are multiple values for an</span>
<span class="sd">            attribute then ensure they appear in the same order every time.</span>
<span class="sd">            This is typically only used for testing, in cases where it is</span>
<span class="sd">            important to have consistent ordering.</span>

<span class="sd">        pragmas : dict</span>
<span class="sd">            Dictionary of pragmas to use when connecting to the database.  See</span>
<span class="sd">            http://www.sqlite.org/pragma.html for the full list of</span>
<span class="sd">            possibilities, and constants.default_pragmas for the defaults.</span>
<span class="sd">            These can be changed later using the :meth:`FeatureDB.set_pragmas`</span>
<span class="sd">            method.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">            `dbfn` can also be a subclass of :class:`_DBCreator`, useful for</span>
<span class="sd">            when :func:`gffutils.create_db` is provided the ``dbfn=&quot;:memory:&quot;``</span>
<span class="sd">            kwarg.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Since specifying the string &quot;:memory:&quot; will actually try to connect</span>
        <span class="c1"># to a new, separate (and empty) db in memory, we can alternatively</span>
        <span class="c1"># pass in a sqlite connection instance to use its existing, in-memory</span>
        <span class="c1"># db.</span>
        <span class="kn">from</span> <span class="nn">gffutils</span> <span class="kn">import</span> <span class="n">create</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dbfn</span><span class="p">,</span> <span class="n">create</span><span class="o">.</span><span class="n">_DBCreator</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">dbfn</span><span class="o">.</span><span class="n">conn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span> <span class="o">=</span> <span class="n">dbfn</span><span class="o">.</span><span class="n">dbfn</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dbfn</span><span class="p">,</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Connection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">dbfn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span> <span class="o">=</span> <span class="n">dbfn</span>
        <span class="c1"># otherwise assume dbfn is a string.</span>
        <span class="k">elif</span> <span class="n">dbfn</span> <span class="o">==</span> <span class="s2">&quot;:memory:&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;cannot connect to memory db; please provide the connection&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbfn</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Database file </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span> <span class="o">%</span> <span class="n">dbfn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span> <span class="o">=</span> <span class="n">dbfn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">text_factory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">text_factory</span> <span class="o">=</span> <span class="n">text_factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_encoding</span> <span class="o">=</span> <span class="n">default_encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_order</span> <span class="o">=</span> <span class="n">keep_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_attribute_values</span> <span class="o">=</span> <span class="n">sort_attribute_values</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="c1"># Load some meta info</span>
        <span class="c1"># TODO: this is a good place to check for previous versions, and offer</span>
        <span class="c1"># to upgrade...</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            SELECT version, dialect FROM meta</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">version</span><span class="p">,</span> <span class="n">dialect</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialect</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">_unjsonify</span><span class="p">(</span><span class="n">dialect</span><span class="p">)</span>

        <span class="c1"># Load directives from db</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            SELECT directive FROM directives</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directives</span> <span class="o">=</span> <span class="p">[</span><span class="n">directive</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">directive</span> <span class="ow">in</span> <span class="n">c</span> <span class="k">if</span> <span class="n">directive</span><span class="p">]</span>

        <span class="c1"># Load autoincrements so that when we add new features, we can start</span>
        <span class="c1"># autoincrementing from where we last left off (instead of from 1,</span>
        <span class="c1"># which would cause name collisions)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            SELECT base, n FROM autoincrements</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoincrements</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_pragmas</span><span class="p">(</span><span class="n">pragmas</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyzed</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;It appears that this database has not had the ANALYZE &quot;</span>
                <span class="s2">&quot;sqlite3 command run on it. Doing so can dramatically &quot;</span>
                <span class="s2">&quot;speed up queries, and is done by default for databases &quot;</span>
                <span class="s2">&quot;created with gffutils &gt;0.8.7.1 (this database was &quot;</span>
                <span class="s2">&quot;created with version </span><span class="si">%s</span><span class="s2">) Consider calling the analyze() &quot;</span>
                <span class="s2">&quot;method of this object.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="FeatureDB.set_pragmas"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.set_pragmas.html#gffutils.interface.FeatureDB.set_pragmas">[docs]</a>    <span class="k">def</span> <span class="nf">set_pragmas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pragmas</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set pragmas for the current database connection.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pragmas : dict</span>
<span class="sd">            Dictionary of pragmas; see constants.default_pragmas for a template</span>
<span class="sd">            and http://www.sqlite.org/pragma.html for a full list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pragmas</span> <span class="o">=</span> <span class="n">pragmas</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="s2">&quot;;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;PRAGMA </span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pragmas</span><span class="o">.</span><span class="n">items</span><span class="p">()]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_feature_returner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a feature, adding additional database-specific defaults</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;dialect&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;keep_order&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_order</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;sort_attribute_values&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_attribute_values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_analyzed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            SELECT name FROM sqlite_master WHERE type=&#39;table&#39;</span>
<span class="sd">            AND name=&#39;sqlite_stat1&#39;;</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>

<div class="viewcode-block" id="FeatureDB.schema"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.schema.html#gffutils.interface.FeatureDB.schema">[docs]</a>    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the database schema as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            SELECT sql FROM sqlite_master</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Feature</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">id</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">_SELECT</span> <span class="o">+</span> <span class="s2">&quot; WHERE id = ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,))</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="n">constants</span><span class="o">.</span><span class="n">_SELECT</span> <span class="o">+</span> <span class="s2">&quot; WHERE id = ?&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_encoding</span><span class="p">),),</span>
            <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="c1"># TODO: raise error if more than one key is found</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureNotFoundError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_returner</span><span class="p">(</span><span class="o">**</span><span class="n">results</span><span class="p">)</span>

<div class="viewcode-block" id="FeatureDB.count_features_of_type"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.count_features_of_type.html#gffutils.interface.FeatureDB.count_features_of_type">[docs]</a>    <span class="k">def</span> <span class="nf">count_features_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">featuretype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple count of features.</span>

<span class="sd">        Can be faster than &quot;grep&quot;, and is faster than checking the length of</span>
<span class="sd">        results from :meth:`gffutils.FeatureDB.features_of_type`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        featuretype : string</span>

<span class="sd">            Feature type (e.g., &quot;gene&quot;) to count.  If None, then count *all*</span>
<span class="sd">            features in the database.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The number of features of this type, as an integer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">featuretype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                SELECT count() FROM features</span>
<span class="sd">                WHERE featuretype = ?</span>
<span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">featuretype</span><span class="p">,),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                SELECT count() FROM features</span>
<span class="sd">                &quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="FeatureDB.features_of_type"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.features_of_type.html#gffutils.interface.FeatureDB.features_of_type">[docs]</a>    <span class="k">def</span> <span class="nf">features_of_type</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">featuretype</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">strand</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">completely_within</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator of :class:`gffutils.Feature` objects.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        {_method_doc}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">make_query</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">featuretype</span><span class="o">=</span><span class="n">featuretype</span><span class="p">,</span>
            <span class="n">order_by</span><span class="o">=</span><span class="n">order_by</span><span class="p">,</span>
            <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span>
            <span class="n">strand</span><span class="o">=</span><span class="n">strand</span><span class="p">,</span>
            <span class="n">completely_within</span><span class="o">=</span><span class="n">completely_within</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_returner</span><span class="p">(</span><span class="o">**</span><span class="n">i</span><span class="p">)</span></div>

    <span class="c1"># TODO: convert this to a syntax similar to itertools.groupby</span>
<div class="viewcode-block" id="FeatureDB.iter_by_parent_childs"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.iter_by_parent_childs.html#gffutils.interface.FeatureDB.iter_by_parent_childs">[docs]</a>    <span class="k">def</span> <span class="nf">iter_by_parent_childs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">featuretype</span><span class="o">=</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span>
        <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">completely_within</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For each parent of type `featuretype`, yield a list L of that parent</span>
<span class="sd">        and all of its children (`[parent] + list(children)`). The parent will</span>
<span class="sd">        always be L[0].</span>

<span class="sd">        This is useful for &quot;sanitizing&quot; a GFF file for downstream tools.</span>

<span class="sd">        Additional kwargs are passed to :meth:`FeatureDB.children`, and will</span>
<span class="sd">        therefore only affect items L[1:] in each yielded list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get all the parent records of the requested feature type</span>
        <span class="n">parent_recs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_features</span><span class="p">(</span><span class="n">featuretype</span><span class="o">=</span><span class="n">featuretype</span><span class="p">)</span>
        <span class="c1"># Return a generator of these parent records and their</span>
        <span class="c1"># children</span>
        <span class="k">for</span> <span class="n">parent_rec</span> <span class="ow">in</span> <span class="n">parent_recs</span><span class="p">:</span>
            <span class="n">unit_records</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent_rec</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">parent_rec</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
            <span class="k">yield</span> <span class="n">unit_records</span></div>

<div class="viewcode-block" id="FeatureDB.all_features"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.all_features.html#gffutils.interface.FeatureDB.all_features">[docs]</a>    <span class="k">def</span> <span class="nf">all_features</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">strand</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">featuretype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">completely_within</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through the entire database.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A generator object that yields :class:`Feature` objects.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        {_method_doc}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">make_query</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">strand</span><span class="o">=</span><span class="n">strand</span><span class="p">,</span>
            <span class="n">featuretype</span><span class="o">=</span><span class="n">featuretype</span><span class="p">,</span>
            <span class="n">order_by</span><span class="o">=</span><span class="n">order_by</span><span class="p">,</span>
            <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span>
            <span class="n">completely_within</span><span class="o">=</span><span class="n">completely_within</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_returner</span><span class="p">(</span><span class="o">**</span><span class="n">i</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureDB.featuretypes"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.featuretypes.html#gffutils.interface.FeatureDB.featuretypes">[docs]</a>    <span class="k">def</span> <span class="nf">featuretypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over feature types found in the database.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A generator object that yields featuretypes (as strings)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            SELECT DISTINCT featuretype from features</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span></div>

    <span class="k">def</span> <span class="nf">_relation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">,</span>
        <span class="n">join_on</span><span class="p">,</span>
        <span class="n">join_to</span><span class="p">,</span>
        <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">featuretype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">completely_within</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="c1"># The following docstring will be included in the parents() and</span>
        <span class="c1"># children() docstrings to maintain consistency, since they both</span>
        <span class="c1"># delegate to this method.</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        id : string or a Feature object</span>

<span class="sd">        level : None or int</span>

<span class="sd">            If `level=None` (default), then return all children regardless</span>
<span class="sd">            of level.  If `level` is an integer, then constrain to just that</span>
<span class="sd">            level.</span>
<span class="sd">        {_method_doc}</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A generator object that yields :class:`Feature` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">Feature</span><span class="p">):</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="o">.</span><span class="n">id</span>

        <span class="n">other</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        JOIN relations</span>
<span class="s2">        ON relations.</span><span class="si">{join_on}</span><span class="s2"> = features.id</span>
<span class="s2">        WHERE relations.</span><span class="si">{join_to}</span><span class="s2"> = ?</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="o">**</span><span class="nb">locals</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">]</span>

        <span class="n">level_clause</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">level_clause</span> <span class="o">=</span> <span class="s2">&quot;relations.level = ?&quot;</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

        <span class="n">query</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">make_query</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
            <span class="n">other</span><span class="o">=</span><span class="n">other</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="n">level_clause</span><span class="p">,</span>
            <span class="n">featuretype</span><span class="o">=</span><span class="n">featuretype</span><span class="p">,</span>
            <span class="n">order_by</span><span class="o">=</span><span class="n">order_by</span><span class="p">,</span>
            <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">completely_within</span><span class="o">=</span><span class="n">completely_within</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># modify _SELECT so that only unique results are returned</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;SELECT&quot;</span><span class="p">,</span> <span class="s2">&quot;SELECT DISTINCT&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_returner</span><span class="p">(</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>

<div class="viewcode-block" id="FeatureDB.children"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.children.html#gffutils.interface.FeatureDB.children">[docs]</a>    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">,</span>
        <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">featuretype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">completely_within</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return children of feature `id`.</span>
<span class="sd">        {_relation_docstring}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relation</span><span class="p">(</span>
            <span class="nb">id</span><span class="p">,</span>
            <span class="n">join_on</span><span class="o">=</span><span class="s2">&quot;child&quot;</span><span class="p">,</span>
            <span class="n">join_to</span><span class="o">=</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span>
            <span class="n">featuretype</span><span class="o">=</span><span class="n">featuretype</span><span class="p">,</span>
            <span class="n">order_by</span><span class="o">=</span><span class="n">order_by</span><span class="p">,</span>
            <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">completely_within</span><span class="o">=</span><span class="n">completely_within</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="FeatureDB.parents"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.parents.html#gffutils.interface.FeatureDB.parents">[docs]</a>    <span class="k">def</span> <span class="nf">parents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">,</span>
        <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">featuretype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">completely_within</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return parents of feature `id`.</span>
<span class="sd">        {_relation_docstring}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relation</span><span class="p">(</span>
            <span class="nb">id</span><span class="p">,</span>
            <span class="n">join_on</span><span class="o">=</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span>
            <span class="n">join_to</span><span class="o">=</span><span class="s2">&quot;child&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span>
            <span class="n">featuretype</span><span class="o">=</span><span class="n">featuretype</span><span class="p">,</span>
            <span class="n">order_by</span><span class="o">=</span><span class="n">order_by</span><span class="p">,</span>
            <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">completely_within</span><span class="o">=</span><span class="n">completely_within</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_query</span> <span class="o">=</span> <span class="n">query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">c</span>

<div class="viewcode-block" id="FeatureDB.execute"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.execute.html#gffutils.interface.FeatureDB.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute arbitrary queries on the db.</span>

<span class="sd">        .. seealso::</span>

<span class="sd">                :class:`FeatureDB.schema` may be helpful when writing your own</span>
<span class="sd">                queries.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        query : str</span>

<span class="sd">            Query to execute -- trailing &quot;;&quot; optional.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A sqlite3.Cursor object that can be iterated over.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs the sqlite ANALYZE command to potentially speed up queries</span>
<span class="sd">        dramatically.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;ANALYZE features&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<div class="viewcode-block" id="FeatureDB.region"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.region.html#gffutils.interface.FeatureDB.region">[docs]</a>    <span class="k">def</span> <span class="nf">region</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seqid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">strand</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">featuretype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">completely_within</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return features within specified genomic coordinates.</span>

<span class="sd">        Specifying genomic coordinates can be done in a flexible manner</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        region : string, tuple, or Feature instance</span>
<span class="sd">            If string, then of the form &quot;seqid:start-end&quot;.  If tuple, then</span>
<span class="sd">            (seqid, start, end).  If :class:`Feature`, then use the features</span>
<span class="sd">            seqid, start, and end values.</span>

<span class="sd">            This argument is mutually exclusive with start/end/seqid.</span>

<span class="sd">            *Note*: By design, even if a feature is provided, its strand will</span>
<span class="sd">            be ignored.  If you want to restrict the output by strand, use the</span>
<span class="sd">            separate `strand` kwarg.</span>

<span class="sd">        strand : + | - | . | None</span>
<span class="sd">            If `strand` is provided, then only those features exactly matching</span>
<span class="sd">            `strand` will be returned. So `strand=&#39;.&#39;` will only return</span>
<span class="sd">            unstranded features. Default is `strand=None` which does not</span>
<span class="sd">            restrict by strand.</span>

<span class="sd">        seqid, start, end, strand</span>
<span class="sd">            Mutually exclusive with `region`.  These kwargs can be used to</span>
<span class="sd">            approximate slice notation; see &quot;Details&quot; section below.</span>

<span class="sd">        featuretype : None, string, or iterable</span>
<span class="sd">            If not None, then restrict output.  If string, then only report</span>
<span class="sd">            that feature type.  If iterable, then report all featuretypes in</span>
<span class="sd">            the iterable.</span>

<span class="sd">        completely_within : bool</span>
<span class="sd">            By default (`completely_within=False`), returns features that</span>
<span class="sd">            partially or completely overlap `region`.  If</span>
<span class="sd">            `completely_within=True`, features that are completely within</span>
<span class="sd">            `region` will be returned.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The meaning of `seqid`, `start`, and `end` is interpreted as follows:</span>

<span class="sd">        ====== ====== ===== ======================================</span>
<span class="sd">        seqid  start  end   meaning</span>
<span class="sd">        ====== ====== ===== ======================================</span>
<span class="sd">        str    int    int   equivalent to `region` kwarg</span>
<span class="sd">        None   int    int   features from all chroms within coords</span>
<span class="sd">        str    None   int   equivalent to [:end] slice notation</span>
<span class="sd">        str    int    None  equivalent to [start:] slice notation</span>
<span class="sd">        None   None   None  equivalent to FeatureDB.all_features()</span>
<span class="sd">        ====== ====== ===== ======================================</span>

<span class="sd">        If performance is a concern, use `completely_within=True`. This allows</span>
<span class="sd">        the query to be optimized by only looking for features that fall in the</span>
<span class="sd">        precise genomic bin (same strategy as UCSC Genome Browser and</span>
<span class="sd">        BEDTools). Otherwise all features&#39; start/stop coords need to be</span>
<span class="sd">        searched to see if they partially overlap the region of interest.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        - `region(seqid=&quot;chr1&quot;, start=1000)` returns all features on chr1 that</span>
<span class="sd">          start or extend past position 1000</span>

<span class="sd">        - `region(seqid=&quot;chr1&quot;, start=1000, completely_within=True)` returns</span>
<span class="sd">          all features on chr1 that start past position 1000.</span>

<span class="sd">        - `region(&quot;chr1:1-100&quot;, strand=&quot;+&quot;, completely_within=True)` returns</span>
<span class="sd">          only plus-strand features that completely fall within positions 1 to</span>
<span class="sd">          100 on chr1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A generator object that yields :class:`Feature` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Argument handling.</span>
        <span class="k">if</span> <span class="n">region</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">seqid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;If region is supplied, do not supply seqid, &quot;</span>
                    <span class="s2">&quot;start, or end as separate kwargs&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">toks</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">seqid</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">seqid</span><span class="p">,</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">strand</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">Feature</span><span class="p">):</span>
                <span class="n">seqid</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">seqid</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">start</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">end</span>
                <span class="n">strand</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">strand</span>

            <span class="c1"># otherwise assume it&#39;s a tuple</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">seqid</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">region</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

        <span class="c1"># e.g.,</span>
        <span class="c1">#   completely_within=True..... start &gt;= {start} AND end &lt;= {end}</span>
        <span class="c1">#   completely_within=False.... start &lt;  {end}   AND end &gt;  {start}</span>
        <span class="k">if</span> <span class="n">completely_within</span><span class="p">:</span>
            <span class="n">start_op</span> <span class="o">=</span> <span class="s2">&quot;&gt;=&quot;</span>
            <span class="n">end_op</span> <span class="o">=</span> <span class="s2">&quot;&lt;=&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_op</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span>
            <span class="n">end_op</span> <span class="o">=</span> <span class="s2">&quot;&gt;&quot;</span>
            <span class="n">end</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">position_clause</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">seqid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">position_clause</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;seqid = ?&quot;</span><span class="p">)</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seqid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

        <span class="c1"># See #129</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">completely_within</span><span class="p">:</span>
            <span class="n">position_clause</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;(</span>
<span class="sd">                ({region_start} &lt;= start AND {region_end} &gt;= start) OR</span>
<span class="sd">                ({region_start} &gt;= start AND {region_end} &lt;= end) OR</span>
<span class="sd">                ({region_start} &lt;= end AND {region_end} &gt;= end)</span>
<span class="sd">            )&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">region_start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">region_end</span><span class="o">=</span><span class="n">end</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
                <span class="n">position_clause</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;start </span><span class="si">%s</span><span class="s2"> ?&quot;</span> <span class="o">%</span> <span class="n">start_op</span><span class="p">)</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end</span><span class="p">:</span>
                <span class="n">position_clause</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;end </span><span class="si">%s</span><span class="s2"> ?&quot;</span> <span class="o">%</span> <span class="n">end_op</span><span class="p">)</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

        <span class="n">position_clause</span> <span class="o">=</span> <span class="s2">&quot; AND &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">position_clause</span><span class="p">)</span>

        <span class="c1"># Only use bins if we have defined boundaries and completely_within is</span>
        <span class="c1"># True. Otherwise you can&#39;t know how far away a feature stretches</span>
        <span class="c1"># (which means bins are not computable ahead of time)</span>
        <span class="n">_bin_clause</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">completely_within</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">bins</span><span class="o">.</span><span class="n">MAX_CHROM_SIZE</span> <span class="ow">and</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="n">bins</span><span class="o">.</span><span class="n">MAX_CHROM_SIZE</span><span class="p">:</span>
                <span class="n">_bins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">bins</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">one</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="c1"># See issue #45</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_bins</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">900</span><span class="p">:</span>
                    <span class="n">_bin_clause</span> <span class="o">=</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;bin = ?&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">_bins</span><span class="p">])</span>
                    <span class="n">_bin_clause</span> <span class="o">=</span> <span class="s2">&quot;AND ( </span><span class="si">%s</span><span class="s2"> )&quot;</span> <span class="o">%</span> <span class="n">_bin_clause</span>
                    <span class="n">args</span> <span class="o">+=</span> <span class="n">_bins</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">constants</span><span class="o">.</span><span class="n">_SELECT</span><span class="p">,</span> <span class="s2">&quot;WHERE &quot;</span><span class="p">,</span> <span class="n">position_clause</span><span class="p">,</span> <span class="n">_bin_clause</span><span class="p">])</span>

        <span class="c1"># Add the featuretype clause</span>
        <span class="k">if</span> <span class="n">featuretype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">featuretype</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">featuretype</span> <span class="o">=</span> <span class="p">[</span><span class="n">featuretype</span><span class="p">]</span>
            <span class="n">feature_clause</span> <span class="o">=</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;featuretype = ?&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">featuretype</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; AND (</span><span class="si">%s</span><span class="s2">) &quot;</span> <span class="o">%</span> <span class="n">feature_clause</span>
            <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">featuretype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">strand</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">strand_clause</span> <span class="o">=</span> <span class="s2">&quot; and strand = ? &quot;</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="n">strand_clause</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strand</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_query</span> <span class="o">=</span> <span class="n">query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span>
            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end</span><span class="p">,</span>
            <span class="s2">&quot;seqid&quot;</span><span class="p">:</span> <span class="n">seqid</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_returner</span><span class="p">(</span><span class="o">**</span><span class="n">i</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureDB.interfeatures"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.interfeatures.html#gffutils.interface.FeatureDB.interfeatures">[docs]</a>    <span class="k">def</span> <span class="nf">interfeatures</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">,</span>
        <span class="n">new_featuretype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">merge_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">numeric_sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">dialect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attribute_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">update_attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct new features representing the space between features.</span>

<span class="sd">        For example, if `features` is a list of exons, then this method will</span>
<span class="sd">        return the introns.  If `features` is a list of genes, then this method</span>
<span class="sd">        will return the intergenic regions.</span>

<span class="sd">        Providing N features will return N - 1 new features.</span>

<span class="sd">        This method purposefully does *not* do any merging or sorting of</span>
<span class="sd">        coordinates. So nested or overlapping features may not behave as you</span>
<span class="sd">        might expect. You may want to use :meth:`FeatureDB.merge` first, and</span>
<span class="sd">        when selecting features use the `order_by` kwarg, e.g.,</span>
<span class="sd">        `db.features_of_type(&#39;gene&#39;, order_by=(&#39;seqid&#39;, &#39;start&#39;))`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features : iterable of :class:`feature.Feature` instances</span>
<span class="sd">            Sorted, merged iterable</span>

<span class="sd">        new_featuretype : string or None</span>
<span class="sd">            The new features will all be of this type, or, if None (default)</span>
<span class="sd">            then the featuretypes will be constructed from the neighboring</span>
<span class="sd">            features, e.g., `inter_exon_exon`.</span>

<span class="sd">        merge_attributes : bool</span>
<span class="sd">            If True, new features&#39; attributes will be a merge of the neighboring</span>
<span class="sd">            features&#39; attributes.  This is useful if you have provided a list of</span>
<span class="sd">            exons; the introns will then retain the transcript and/or gene</span>
<span class="sd">            parents as a single item. Otherwise, if False, the attribute will</span>
<span class="sd">            be a comma-separated list of values, potentially listing the same</span>
<span class="sd">            gene ID twice.</span>

<span class="sd">        numeric_sort : bool</span>
<span class="sd">            If True, then merged attributes that can be cast to float will be</span>
<span class="sd">            sorted by their numeric values (but will still be returned as</span>
<span class="sd">            string). This is useful, for example, when creating introns between</span>
<span class="sd">            exons and the exons have exon_number attributes as an integer.</span>
<span class="sd">            Using numeric_sort=True will ensure that the returned exons have</span>
<span class="sd">            merged exon_number attribute of [&#39;9&#39;, &#39;10&#39;] (numerically sorted)</span>
<span class="sd">            rather than [&#39;10&#39;, &#39;9&#39;] (alphabetically sorted).</span>

<span class="sd">        attribute_func : callable or None</span>
<span class="sd">            If None, then nothing special is done to the attributes.  If</span>
<span class="sd">            callable, then the callable accepts two attribute dictionaries and</span>
<span class="sd">            returns a single attribute dictionary.  If `merge_attributes` is</span>
<span class="sd">            True, then `attribute_func` is called before `merge_attributes`.</span>
<span class="sd">            This could be useful for manually managing IDs for the new</span>
<span class="sd">            features.</span>

<span class="sd">        update_attributes : dict</span>
<span class="sd">            After attributes have been modified and merged, this dictionary can</span>
<span class="sd">            be used to replace parts of the attributes dictionary.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A generator that yields :class:`Feature` objects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_init_interfeature</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Used to initialize a new interfeature that is ready to be updated</span>
<span class="sd">            in-place.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;seqid&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;featuretype&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="s1">&#39;strand&#39;</span><span class="p">,</span> <span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="s1">&#39;attributes&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">astuple</span><span class="p">()))</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gffutils_derived&#39;</span>
            <span class="k">return</span> <span class="n">d</span>

        <span class="k">def</span> <span class="nf">_prep_for_yield</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Finalize the interfeature by adjusting coords, recalculating the</span>
<span class="sd">            bin, and creating a feature using self._feature_returner.</span>

<span class="sd">            If start is greater than stop (which happens when trying to get</span>
<span class="sd">            interfeatures for overlapping features), then return None.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">new_bin</span> <span class="o">=</span> <span class="n">bins</span><span class="o">.</span><span class="n">bins</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span> <span class="n">one</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_bin</span>

            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_returner</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>

        <span class="c1"># If not provided, use a no-op function instead.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">attribute_func</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">attribute_func</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">a</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="c1"># First feature: initialize an interfeature and continue to the next.</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">interfeature</span> <span class="o">=</span> <span class="n">_init_interfeature</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">last_feature</span> <span class="o">=</span> <span class="n">f</span>
                <span class="n">nfeatures</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="c1"># Yield the last interfeature (if we saw at least 2 features) and</span>
            <span class="c1"># start a new interfeature on this chrom.</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">chrom</span> <span class="o">!=</span> <span class="n">last_feature</span><span class="o">.</span><span class="n">chrom</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nfeatures</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_feature</span> <span class="o">=</span> <span class="n">_prep_for_yield</span><span class="p">(</span><span class="n">interfeature</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">new_feature</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="n">new_feature</span>
                <span class="n">interfeature</span> <span class="o">=</span> <span class="n">_init_interfeature</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">last_feature</span> <span class="o">=</span> <span class="n">f</span>
                <span class="n">nfeatures</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="c1"># Otherwise, we&#39;ve already seen a feature on this chrom so</span>
            <span class="c1"># this is the second.</span>
            <span class="n">nfeatures</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Adjust the interfeature dict in-place with coords...</span>
            <span class="n">interfeature</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_feature</span><span class="o">.</span><span class="n">stop</span>
            <span class="n">interfeature</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">start</span>

            <span class="c1"># ...featuretype</span>
            <span class="k">if</span> <span class="n">new_featuretype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">interfeature</span><span class="p">[</span><span class="s1">&#39;featuretype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;inter_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">last_feature</span><span class="o">.</span><span class="n">featuretype</span><span class="p">,</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">featuretype</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interfeature</span><span class="p">[</span><span class="s1">&#39;featuretype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_featuretype</span>

            <span class="c1"># ...strand</span>
            <span class="k">if</span> <span class="n">last_feature</span><span class="o">.</span><span class="n">strand</span> <span class="o">!=</span> <span class="n">f</span><span class="o">.</span><span class="n">strand</span><span class="p">:</span>
                <span class="n">interfeature</span><span class="p">[</span><span class="s1">&#39;strand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interfeature</span><span class="p">[</span><span class="s1">&#39;strand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">strand</span>

            <span class="c1"># and attributes</span>
            <span class="k">if</span> <span class="n">merge_attributes</span><span class="p">:</span>
                <span class="n">new_attributes</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">merge_attributes</span><span class="p">(</span>
                    <span class="n">attribute_func</span><span class="p">(</span><span class="n">last_feature</span><span class="o">.</span><span class="n">attributes</span><span class="p">),</span>
                    <span class="n">attribute_func</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">attributes</span><span class="p">),</span>
                    <span class="n">numeric_sort</span><span class="o">=</span><span class="n">numeric_sort</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_attributes</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">update_attributes</span><span class="p">:</span>
                <span class="n">new_attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">update_attributes</span><span class="p">)</span>

            <span class="n">interfeature</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_attributes</span>

            <span class="c1"># Ready to yield</span>
            <span class="n">new_feature</span> <span class="o">=</span> <span class="n">_prep_for_yield</span><span class="p">(</span><span class="n">interfeature</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_feature</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">new_feature</span>
            <span class="n">nfeatures</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">last_feature</span> <span class="o">=</span> <span class="n">f</span></div>

<div class="viewcode-block" id="FeatureDB.delete"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.delete.html#gffutils.interface.FeatureDB.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">make_backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete features from database.</span>

<span class="sd">        features : str, iterable, FeatureDB instance</span>
<span class="sd">            If FeatureDB, all features will be used. If string, assume it&#39;s the</span>
<span class="sd">            ID of the feature to remove. Otherwise, assume it&#39;s an iterable of</span>
<span class="sd">            Feature objects. The classes in gffutils.iterators may be helpful</span>
<span class="sd">            in this case.</span>

<span class="sd">        make_backup : bool</span>
<span class="sd">            If True, and the database you&#39;re about to update is a file on disk,</span>
<span class="sd">            makes a copy of the existing database and saves it with a .bak</span>
<span class="sd">            extension.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FeatureDB object, with features deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">make_backup</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span> <span class="o">+</span> <span class="s2">&quot;.bak&quot;</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">query1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DELETE FROM features WHERE id = ?</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">query2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DELETE FROM relations WHERE parent = ? OR child = ?</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">FeatureDB</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">all_features</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">features</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">Feature</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">features</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">_id</span> <span class="o">=</span> <span class="n">feature</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_id</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">id</span>
            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query1</span><span class="p">,</span> <span class="p">(</span><span class="n">_id</span><span class="p">,))</span>
            <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query2</span><span class="p">,</span> <span class="p">(</span><span class="n">_id</span><span class="p">,</span> <span class="n">_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="FeatureDB.update"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.update.html#gffutils.interface.FeatureDB.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">make_backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the on-disk database with features in `data`.</span>

<span class="sd">        WARNING: If you used any non-default kwargs for gffutils.create_db when</span>
<span class="sd">        creating the database in the first place (especially</span>
<span class="sd">        `disable_infer_transcripts` or `disable_infer_genes`) then you should</span>
<span class="sd">        use those same arguments here.</span>

<span class="sd">        The returned object is the same FeatureDB, but since it is pointing to</span>
<span class="sd">        the same database and that has been just updated, the new features can</span>
<span class="sd">        now be accessed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        data : str, iterable, FeatureDB instance</span>
<span class="sd">            If FeatureDB, all data will be used. If string, assume it&#39;s</span>
<span class="sd">            a filename of a GFF or GTF file.  Otherwise, assume it&#39;s an</span>
<span class="sd">            iterable of Feature objects.  The classes in gffutils.iterators may</span>
<span class="sd">            be helpful in this case.</span>

<span class="sd">        make_backup : bool</span>
<span class="sd">            If True, and the database you&#39;re about to update is a file on disk,</span>
<span class="sd">            makes a copy of the existing database and saves it with a .bak</span>
<span class="sd">            extension.</span>

<span class="sd">        kwargs :</span>
<span class="sd">            Additional kwargs are passed to gffutils.create_db; see the help</span>
<span class="sd">            for that function for details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Returns self but with the underlying database updated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">gffutils</span> <span class="kn">import</span> <span class="n">create</span>
        <span class="kn">from</span> <span class="nn">gffutils</span> <span class="kn">import</span> <span class="n">iterators</span>

        <span class="k">if</span> <span class="n">make_backup</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span> <span class="o">+</span> <span class="s2">&quot;.bak&quot;</span><span class="p">)</span>

        <span class="c1"># get iterator-specific kwargs</span>
        <span class="n">_iterator_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">_iterator_kwargs</span><span class="p">:</span>
                <span class="n">_iterator_kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c1"># Handle all sorts of input</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">iterators</span><span class="o">.</span><span class="n">DataIterator</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">_iterator_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">_peek</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;_autoincrements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoincrements</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect</span><span class="p">[</span><span class="s2">&quot;fmt&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gtf&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;id_spec&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id_spec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gene&quot;</span><span class="p">:</span> <span class="s2">&quot;gene_id&quot;</span><span class="p">,</span> <span class="s2">&quot;transcript&quot;</span><span class="p">:</span> <span class="s2">&quot;transcript_id&quot;</span><span class="p">}</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">create</span><span class="o">.</span><span class="n">_GTFDBCreator</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">dbfn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dialect</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect</span><span class="p">[</span><span class="s2">&quot;fmt&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gff3&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;id_spec&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id_spec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ID&quot;</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">create</span><span class="o">.</span><span class="n">_GFFDBCreator</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">dbfn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dbfn</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dialect</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="n">db</span><span class="o">.</span><span class="n">_populate_from_lines</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">_update_relations</span><span class="p">()</span>

        <span class="c1"># Note that the autoincrements gets updated here</span>
        <span class="n">db</span><span class="o">.</span><span class="n">_finalize</span><span class="p">()</span>

        <span class="c1"># Read it back in directly from the stored autoincrements table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoincrements</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">_autoincrements</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="FeatureDB.add_relation"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.add_relation.html#gffutils.interface.FeatureDB.add_relation">[docs]</a>    <span class="k">def</span> <span class="nf">add_relation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">parent_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">child_func</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manually add relations to the database.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent : str or Feature instance</span>
<span class="sd">             Parent feature to add.</span>

<span class="sd">        child : str or Feature instance</span>
<span class="sd">            Child feature to add</span>

<span class="sd">        level : int</span>
<span class="sd">            Level of the relation.  For example, if parent is a gene and child</span>
<span class="sd">            is an mRNA, then you might want level to be 1.  But if child is an</span>
<span class="sd">            exon, then level would be 2.</span>

<span class="sd">        parent_func, child_func : callable</span>
<span class="sd">            These optional functions control how attributes are updated in the</span>
<span class="sd">            database.  They both have the signature `func(parent, child)` and</span>
<span class="sd">            must return a [possibly modified] Feature instance.  For example,</span>
<span class="sd">            we could add the child&#39;s database id as the &quot;child&quot; attribute in</span>
<span class="sd">            the parent::</span>

<span class="sd">                def parent_func(parent, child):</span>
<span class="sd">                    parent.attributes[&#39;child&#39;] = child.id</span>

<span class="sd">            and add the parent&#39;s &quot;gene_id&quot; as the child&#39;s &quot;Parent&quot; attribute::</span>

<span class="sd">                def child_func(parent, child):</span>
<span class="sd">                    child.attributes[&#39;Parent&#39;] = parent[&#39;gene_id&#39;]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FeatureDB object with new relations added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">child</span><span class="p">]</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                  INSERT INTO relations (parent, child, level)</span>
<span class="sd">                  VALUES (?, ?, ?)&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">level</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">parent_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">parent_func</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">child_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">child_func</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">astuple</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">id</span><span class="p">]]</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">_UPDATE</span><span class="p">,</span> <span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a feature into the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">_INSERT</span><span class="p">,</span> <span class="n">feature</span><span class="o">.</span><span class="n">astuple</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">_INSERT</span><span class="p">,</span> <span class="n">feature</span><span class="o">.</span><span class="n">astuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_encoding</span><span class="p">))</span>

<div class="viewcode-block" id="FeatureDB.create_introns"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.create_introns.html#gffutils.interface.FeatureDB.create_introns">[docs]</a>    <span class="k">def</span> <span class="nf">create_introns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exon_featuretype</span><span class="o">=</span><span class="s2">&quot;exon&quot;</span><span class="p">,</span>
        <span class="n">grandparent_featuretype</span><span class="o">=</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span>
        <span class="n">parent_featuretype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">new_featuretype</span><span class="o">=</span><span class="s2">&quot;intron&quot;</span><span class="p">,</span>
        <span class="n">merge_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">numeric_sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create introns from existing annotations.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        exon_featuretype : string</span>
<span class="sd">            Feature type to use in order to infer introns.  Typically `&quot;exon&quot;`.</span>

<span class="sd">        grandparent_featuretype : string</span>
<span class="sd">            If `grandparent_featuretype` is not None, then group exons by</span>
<span class="sd">            children of this featuretype.  If `granparent_featuretype` is</span>
<span class="sd">            &quot;gene&quot; (default), then introns will be created for all first-level</span>
<span class="sd">            children of genes.  This may include mRNA, rRNA, ncRNA, etc.  If</span>
<span class="sd">            you only want to infer introns from one of these featuretypes</span>
<span class="sd">            (e.g., mRNA), then use the `parent_featuretype` kwarg which is</span>
<span class="sd">            mutually exclusive with `grandparent_featuretype`.</span>

<span class="sd">        parent_featuretype : string</span>
<span class="sd">            If `parent_featuretype` is not None, then only use this featuretype</span>
<span class="sd">            to infer introns.  Use this if you only want a subset of</span>
<span class="sd">            featuretypes to have introns (e.g., &quot;mRNA&quot; only, and not ncRNA or</span>
<span class="sd">            rRNA). Mutually exclusive with `grandparent_featuretype`.</span>

<span class="sd">        new_featuretype : string</span>
<span class="sd">            Feature type to use for the inferred introns; default is</span>
<span class="sd">            `&quot;intron&quot;`.</span>

<span class="sd">        merge_attributes : bool</span>
<span class="sd">            Whether or not to merge attributes from all exons. If False then no</span>
<span class="sd">            attributes will be created for the introns.</span>

<span class="sd">        numeric_sort : bool</span>
<span class="sd">            If True, then merged attributes that can be cast to float will be</span>
<span class="sd">            sorted by their numeric values (but will still be returned as</span>
<span class="sd">            string). This is useful, for example, when creating introns between</span>
<span class="sd">            exons and the exons have exon_number attributes as an integer.</span>
<span class="sd">            Using numeric_sort=True will ensure that the returned exons have</span>
<span class="sd">            merged exon_number attribute of [&#39;9&#39;, &#39;10&#39;] (numerically sorted)</span>
<span class="sd">            rather than [&#39;10&#39;, &#39;9&#39;] (alphabetically sorted).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A generator object that yields :class:`Feature` objects representing</span>
<span class="sd">        new introns</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The returned generator can be passed directly to the</span>
<span class="sd">        :meth:`FeatureDB.update` method to permanently add them to the</span>
<span class="sd">        database, e.g., ::</span>

<span class="sd">            db.update(db.create_introns())</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">grandparent_featuretype</span> <span class="ow">and</span> <span class="n">parent_featuretype</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">grandparent_featuretype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">parent_featuretype</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;exactly one of `grandparent_featuretype` or &quot;</span>
                <span class="s2">&quot;`parent_featuretype` should be provided&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">grandparent_featuretype</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">child_gen</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_of_type</span><span class="p">(</span><span class="n">grandparent_featuretype</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">gene</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">child</span>

        <span class="k">elif</span> <span class="n">parent_featuretype</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">child_gen</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_of_type</span><span class="p">(</span><span class="n">parent_featuretype</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">child</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">child_gen</span><span class="p">():</span>
            <span class="n">exons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">(</span>
                <span class="n">child</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">featuretype</span><span class="o">=</span><span class="n">exon_featuretype</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;start&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">intron</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interfeatures</span><span class="p">(</span>
                <span class="n">exons</span><span class="p">,</span>
                <span class="n">new_featuretype</span><span class="o">=</span><span class="n">new_featuretype</span><span class="p">,</span>
                <span class="n">merge_attributes</span><span class="o">=</span><span class="n">merge_attributes</span><span class="p">,</span>
                <span class="n">numeric_sort</span><span class="o">=</span><span class="n">numeric_sort</span><span class="p">,</span>
                <span class="n">dialect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dialect</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="k">yield</span> <span class="n">intron</span></div>

    <span class="k">def</span> <span class="nf">_old_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">ignore_strand</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        DEPRECATED, only retained here for backwards compatibility. Please use</span>
<span class="sd">        merge().</span>

<span class="sd">        Merge overlapping features together.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        features : iterator of Feature instances</span>

<span class="sd">        ignore_strand : bool</span>
<span class="sd">            If True, features on multiple strands will be merged, and the final</span>
<span class="sd">            strand will be set to &#39;.&#39;.  Otherwise, ValueError will be raised if</span>
<span class="sd">            trying to merge features on differnt strands.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A generator object that yields :class:`Feature` objects representing</span>
<span class="sd">        the newly merged features.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Consume iterator up front...</span>
        <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>

        <span class="c1"># Either set all strands to &#39;+&#39; or check for strand-consistency.</span>
        <span class="k">if</span> <span class="n">ignore_strand</span><span class="p">:</span>
            <span class="n">strand</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strands</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strand</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">strands</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Specify ignore_strand=True to force merging &quot;</span> <span class="s2">&quot;of multiple strands&quot;</span>
                <span class="p">)</span>
            <span class="n">strand</span> <span class="o">=</span> <span class="n">strands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Sanity check to make sure all features are from the same chromosome.</span>
        <span class="n">chroms</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">chrom</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chroms</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Merging multiple chromosomes not &quot;</span> <span class="s2">&quot;implemented&quot;</span><span class="p">)</span>
        <span class="n">chrom</span> <span class="o">=</span> <span class="n">chroms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># To start, we create a merged feature of just the first feature.</span>
        <span class="n">current_merged_start</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>
        <span class="n">current_merged_stop</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span>

        <span class="c1"># We don&#39;t need to check the first one, so start at feature #2.</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="c1"># Does this feature start within the currently merged feature?...</span>
            <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;=</span> <span class="n">current_merged_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># ...It starts within, so leave current_merged_start where it</span>
                <span class="c1"># is.  Does it extend any farther?</span>
                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">stop</span> <span class="o">&gt;=</span> <span class="n">current_merged_stop</span><span class="p">:</span>
                    <span class="c1"># Extends further, so set a new stop position</span>
                    <span class="n">current_merged_stop</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">stop</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If feature.stop &lt; current_merged_stop, it&#39;s completely</span>
                    <span class="c1"># within the previous feature.  Nothing more to do.</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># The start position is outside the merged feature, so we&#39;re</span>
                <span class="c1"># done with the current merged feature.  Prepare for output...</span>
                <span class="n">merged_feature</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">seqid</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span>
                    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
                    <span class="n">featuretype</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">featuretype</span><span class="p">,</span>
                    <span class="n">start</span><span class="o">=</span><span class="n">current_merged_start</span><span class="p">,</span>
                    <span class="n">end</span><span class="o">=</span><span class="n">current_merged_stop</span><span class="p">,</span>
                    <span class="n">score</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
                    <span class="n">strand</span><span class="o">=</span><span class="n">strand</span><span class="p">,</span>
                    <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
                    <span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_returner</span><span class="p">(</span><span class="o">**</span><span class="n">merged_feature</span><span class="p">)</span>

                <span class="c1"># and we start a new one, initializing with this feature&#39;s</span>
                <span class="c1"># start and stop.</span>
                <span class="n">current_merged_start</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">start</span>
                <span class="n">current_merged_stop</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">stop</span>

        <span class="c1"># need to yield the last one.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">merged_feature</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">seqid</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">featuretype</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">featuretype</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="n">current_merged_start</span><span class="p">,</span>
            <span class="n">end</span><span class="o">=</span><span class="n">current_merged_stop</span><span class="p">,</span>
            <span class="n">score</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">strand</span><span class="o">=</span><span class="n">strand</span><span class="p">,</span>
            <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_returner</span><span class="p">(</span><span class="o">**</span><span class="n">merged_feature</span><span class="p">)</span>

<div class="viewcode-block" id="FeatureDB.merge"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.merge.html#gffutils.interface.FeatureDB.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">,</span>
        <span class="n">merge_criteria</span><span class="o">=</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">seqid</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">overlap_end_inclusive</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">strand</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">feature_type</span><span class="p">),</span>
        <span class="n">multiline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge features matching criteria together</span>


<span class="sd">        Returned Features have a special property called &#39;children&#39; that is</span>
<span class="sd">        a list of the component features.  This only exists for the lifetime of</span>
<span class="sd">        the Feature instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features : iterable</span>
<span class="sd">            Iterable of Feature instances to merge</span>

<span class="sd">        merge_criteria : list</span>
<span class="sd">            List of merge criteria callbacks. All must evaluate to True in</span>
<span class="sd">            order for a feature to be merged. See notes below on callback</span>
<span class="sd">            signature.</span>

<span class="sd">        multiline : bool</span>
<span class="sd">            True to emit multiple features with the same ID attribute, False</span>
<span class="sd">            otherwise.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Generator yielding merged Features</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        See the `gffutils.merge_criteria` module (imported here as `mc`) for</span>
<span class="sd">        existing callback functions. For writing custom callbacks, functions</span>
<span class="sd">        must have the following signature::</span>

<span class="sd">            callback(</span>
<span class="sd">                acc: gffutils.Feature,</span>
<span class="sd">                cur: gffutils.Feature,</span>
<span class="sd">                components: [gffutils.Feature]</span>
<span class="sd">            ) -&gt; bool</span>

<span class="sd">        Where:</span>

<span class="sd">            - `acc`: current accumulated feature</span>
<span class="sd">            - `cur`: candidate feature to merge</span>
<span class="sd">            - `components`: list of features that compose acc</span>

<span class="sd">        The function should return True to merge `cur` into `acc`, False to set</span>
<span class="sd">        `cur` to `acc` (that is, start a new merged feature).</span>

<span class="sd">        If merge criteria allows different feature types then the merged</span>
<span class="sd">        features&#39; feature types should have their featuretype property</span>
<span class="sd">        reassigned to a more specific ontology value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">merge_criteria</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">merge_criteria</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">merge_criteria</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">merge_criteria</span> <span class="o">=</span> <span class="p">[</span><span class="n">merge_criteria</span><span class="p">]</span>

        <span class="c1"># To start, we create a merged feature of just the first feature.</span>
        <span class="n">features</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">last_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_merged</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">feature_children</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_merged</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="n">criteria</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">feature_children</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">criteria</span> <span class="ow">in</span> <span class="n">merge_criteria</span>
                <span class="p">):</span>
                    <span class="n">current_merged</span> <span class="o">=</span> <span class="n">feature</span>
                    <span class="n">feature_children</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">_finalize_merge</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">no_children</span><span class="p">)</span>
                    <span class="n">last_id</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">feature_children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">):</span>  <span class="c1"># current_merged is last feature and unchecked</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="n">criteria</span><span class="p">(</span><span class="n">current_merged</span><span class="p">,</span> <span class="n">current_merged</span><span class="p">,</span> <span class="n">feature_children</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">criteria</span> <span class="ow">in</span> <span class="n">merge_criteria</span>
                <span class="p">):</span>
                    <span class="n">feature_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_merged</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">_finalize_merge</span><span class="p">(</span><span class="n">current_merged</span><span class="p">,</span> <span class="n">no_children</span><span class="p">)</span>
                    <span class="n">current_merged</span> <span class="o">=</span> <span class="n">feature</span>
                    <span class="n">last_id</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">criteria</span><span class="p">(</span><span class="n">current_merged</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">feature_children</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">criteria</span> <span class="ow">in</span> <span class="n">merge_criteria</span>
            <span class="p">):</span>
                <span class="c1"># Criteria satisfied, merge</span>
                <span class="c1"># TODO Test multiline records and iron out the following code</span>
                <span class="c1"># if multiline and (feature.start &gt; current_merged.end + 1 or feature.end + 1 &lt; current_merged.start):</span>
                <span class="c1">#    # Feature is possibly multiline (discontiguous), keep ID but start new record</span>
                <span class="c1">#    yield _finalize_merge(current_merged, feature_children)</span>
                <span class="c1">#    current_merged = feature</span>
                <span class="c1">#    feature_children = [feature]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Current merged is only child and merge is going to occur, make copy</span>
                    <span class="n">current_merged</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">current_merged</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">del</span> <span class="n">current_merged</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">current_merged</span><span class="p">[</span><span class="s2">&quot;extra&quot;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">current_merged</span><span class="p">[</span><span class="s2">&quot;dialect&quot;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">current_merged</span><span class="p">[</span><span class="s2">&quot;keep_order&quot;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">current_merged</span><span class="p">[</span><span class="s2">&quot;sort_attribute_values&quot;</span><span class="p">]</span>
                    <span class="n">current_merged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_returner</span><span class="p">(</span><span class="o">**</span><span class="n">current_merged</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">last_id</span><span class="p">:</span>
                        <span class="c1"># Generate unique ID for new Feature</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_autoincrements</span><span class="p">[</span><span class="n">current_merged</span><span class="o">.</span><span class="n">featuretype</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">last_id</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">current_merged</span><span class="o">.</span><span class="n">featuretype</span>
                            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_autoincrements</span><span class="p">[</span><span class="n">current_merged</span><span class="o">.</span><span class="n">featuretype</span><span class="p">])</span>
                        <span class="p">)</span>
                    <span class="n">current_merged</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_id</span>
                    <span class="n">current_merged</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">last_id</span>

                <span class="n">feature_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

                <span class="c1"># Set mismatched properties to ambiguous values</span>
                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">seqid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_merged</span><span class="o">.</span><span class="n">seqid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
                    <span class="n">current_merged</span><span class="o">.</span><span class="n">seqid</span> <span class="o">+=</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">feature</span><span class="o">.</span><span class="n">seqid</span>
                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">strand</span> <span class="o">!=</span> <span class="n">current_merged</span><span class="o">.</span><span class="n">strand</span><span class="p">:</span>
                    <span class="n">current_merged</span><span class="o">.</span><span class="n">strand</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">frame</span> <span class="o">!=</span> <span class="n">current_merged</span><span class="o">.</span><span class="n">frame</span><span class="p">:</span>
                    <span class="n">current_merged</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">featuretype</span> <span class="o">!=</span> <span class="n">current_merged</span><span class="o">.</span><span class="n">featuretype</span><span class="p">:</span>
                    <span class="n">current_merged</span><span class="o">.</span><span class="n">featuretype</span> <span class="o">=</span> <span class="s2">&quot;sequence_feature&quot;</span>

                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="n">current_merged</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
                    <span class="c1"># Extends prior, so set a new start position</span>
                    <span class="n">current_merged</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">start</span>

                <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">end</span> <span class="o">&gt;</span> <span class="n">current_merged</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
                    <span class="c1"># Extends further, so set a new stop position</span>
                    <span class="n">current_merged</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">end</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">_finalize_merge</span><span class="p">(</span><span class="n">current_merged</span><span class="p">,</span> <span class="n">feature_children</span><span class="p">)</span>
                <span class="n">current_merged</span> <span class="o">=</span> <span class="n">feature</span>
                <span class="n">feature_children</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">last_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">current_merged</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">_finalize_merge</span><span class="p">(</span><span class="n">current_merged</span><span class="p">,</span> <span class="n">feature_children</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">merge_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">merge_order</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;seqid&quot;</span><span class="p">,</span> <span class="s2">&quot;featuretype&quot;</span><span class="p">,</span> <span class="s2">&quot;strand&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">),</span>
        <span class="n">merge_criteria</span><span class="o">=</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">seqid</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">overlap_end_inclusive</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">strand</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">feature_type</span><span class="p">),</span>
        <span class="n">featuretypes_groups</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,),</span>
        <span class="n">exclude_components</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge all features in database according to criteria.</span>
<span class="sd">        Merged features will be assigned as children of the merged record.</span>
<span class="sd">        The resulting records are added to the database.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        merge_order : list</span>
<span class="sd">            Ordered list of columns with which to group features before evaluating criteria</span>
<span class="sd">        merge_criteria : list</span>
<span class="sd">            List of merge criteria callbacks. See merge().</span>
<span class="sd">        featuretypes_groups : list</span>
<span class="sd">            iterable of sets of featuretypes to merge together</span>
<span class="sd">        exclude_components : bool</span>
<span class="sd">            True: child features will be discarded. False to keep them.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            list of merge features</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">featuretypes_groups</span><span class="p">):</span>
            <span class="c1"># Can&#39;t be empty</span>
            <span class="n">featuretypes_groups</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>

        <span class="n">result_features</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Merge features per featuregroup</span>
        <span class="k">for</span> <span class="n">featuregroup</span> <span class="ow">in</span> <span class="n">featuretypes_groups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">merged</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_features</span><span class="p">(</span><span class="n">featuretype</span><span class="o">=</span><span class="n">featuregroup</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="n">merge_order</span><span class="p">),</span>
                <span class="n">merge_criteria</span><span class="o">=</span><span class="n">merge_criteria</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="c1"># If feature is result of merge</span>
                <span class="k">if</span> <span class="n">merged</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_insert</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">exclude_components</span><span class="p">:</span>
                        <span class="c1"># Remove child features from DB</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Add child relations to DB</span>
                        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">merged</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_relation</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">child_func</span><span class="o">=</span><span class="n">assign_child</span><span class="p">)</span>
                    <span class="n">result_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># Do nothing, feature is already in DB</span>

        <span class="k">return</span> <span class="n">result_features</span>

<div class="viewcode-block" id="FeatureDB.children_bp"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.children_bp.html#gffutils.interface.FeatureDB.children_bp">[docs]</a>    <span class="k">def</span> <span class="nf">children_bp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">child_featuretype</span><span class="o">=</span><span class="s2">&quot;exon&quot;</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">merge_criteria</span><span class="o">=</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">seqid</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">overlap_end_inclusive</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">strand</span><span class="p">,</span>
                            <span class="n">mc</span><span class="o">.</span><span class="n">feature_type</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Total bp of all children of a featuretype.</span>

<span class="sd">        Useful for getting the exonic bp of an mRNA.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        feature : str or Feature instance</span>

<span class="sd">        child_featuretype : str</span>
<span class="sd">            Which featuretype to consider.  For example, to get exonic bp of an</span>
<span class="sd">            mRNA, use `child_featuretype=&#39;exon&#39;`.</span>

<span class="sd">        merge : bool</span>
<span class="sd">            Whether or not to merge child features together before summing</span>
<span class="sd">            them.</span>

<span class="sd">        merge_criteria : list</span>
<span class="sd">            List of merge criteria callbacks. All must evaluate to True in</span>
<span class="sd">            order for a feature to be merged. Only used if merge=True. When</span>
<span class="sd">            modifying this argument, you may want to use:</span>

<span class="sd">                from gffutils import merge_criteria as mc</span>

<span class="sd">            to access the available callbacks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Integer representing the total number of bp.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;ignore_strand&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;&#39;ignore_strand&#39; has been deprecated; please use &quot;</span>
                    <span class="s2">&quot;merge_criteria to control how features should be merged. &quot;</span>
                    <span class="s2">&quot;E.g., leave out the &#39;mc.strand&#39; criteria to ignore strand.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;merge() got unexpected keyword arguments &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">(</span>
            <span class="n">feature</span><span class="p">,</span> <span class="n">featuretype</span><span class="o">=</span><span class="n">child_featuretype</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;start&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">merge</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">merge_criteria</span><span class="o">=</span><span class="n">merge_criteria</span><span class="p">)</span>

        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">total</span></div>

<div class="viewcode-block" id="FeatureDB.bed12"><a class="viewcode-back" href="../../autodocs/gffutils.interface.FeatureDB.bed12.html#gffutils.interface.FeatureDB.bed12">[docs]</a>    <span class="k">def</span> <span class="nf">bed12</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">,</span>
        <span class="n">block_featuretype</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;exon&quot;</span><span class="p">],</span>
        <span class="n">thick_featuretype</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CDS&quot;</span><span class="p">],</span>
        <span class="n">thin_featuretype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name_field</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts `feature` into a BED12 format.</span>

<span class="sd">        GFF and GTF files do not necessarily define genes consistently, so this</span>
<span class="sd">        method provides flexiblity in specifying what to call a &quot;transcript&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        feature : str or Feature instance</span>
<span class="sd">            In most cases, this feature should be a transcript rather than</span>
<span class="sd">            a gene.</span>

<span class="sd">        block_featuretype : str or list</span>
<span class="sd">            Which featuretype to use as the exons. These are represented as</span>
<span class="sd">            blocks in the BED12 format.  Typically &#39;exon&#39;.</span>

<span class="sd">            Use the `thick_featuretype` and `thin_featuretype` arguments to</span>
<span class="sd">            control the display of CDS as thicker blocks and UTRs as thinner</span>
<span class="sd">            blocks.</span>

<span class="sd">            Note that the features for `thick` or `thin` are *not*</span>
<span class="sd">            automatically included in the blocks; if you do want them included,</span>
<span class="sd">            then those featuretypes should be added to this `block_features`</span>
<span class="sd">            list.</span>

<span class="sd">            If no child features of type `block_featuretype` are found, then</span>
<span class="sd">            the full `feature` is returned in BED12 format as if it had</span>
<span class="sd">            a single exon.</span>

<span class="sd">        thick_featuretype : str or list</span>
<span class="sd">            Child featuretype(s) to use in order to determine the boundaries of</span>
<span class="sd">            the &quot;thick&quot; blocks. In BED12 format, these represent coding</span>
<span class="sd">            sequences; typically this would be set to &quot;CDS&quot;.  This argument is</span>
<span class="sd">            mutually exclusive with `thin_featuretype`.</span>

<span class="sd">            Specifically, the BED12 thickStart will be the start coord of the</span>
<span class="sd">            first `thick` item and the thickEnd will be the stop coord of the</span>
<span class="sd">            last `thick` item.</span>

<span class="sd">        thin_featuretype : str or list</span>
<span class="sd">            Child featuretype(s) to use in order to determine the boundaries of</span>
<span class="sd">            the &quot;thin&quot; blocks.  In BED12 format, these represent untranslated</span>
<span class="sd">            regions.  Typically &quot;utr&quot; or [&#39;three_prime_UTR&#39;, &#39;five_prime_UTR&#39;].</span>
<span class="sd">            Mutually exclusive with `thick_featuretype`.</span>

<span class="sd">            Specifically, the BED12 thickStart field will be the stop coord of</span>
<span class="sd">            the first `thin` item and the thickEnd field will be the start</span>
<span class="sd">            coord of the last `thin` item.</span>

<span class="sd">        name_field : str</span>
<span class="sd">            Which attribute of `feature` to use as the feature&#39;s name.  If this</span>
<span class="sd">            field is not present, a &quot;.&quot; placeholder will be used instead.</span>

<span class="sd">        color : None or str</span>
<span class="sd">            If None, then use black (0,0,0) as the RGB color; otherwise this</span>
<span class="sd">            should be a comma-separated string of R,G,B values each of which</span>
<span class="sd">            are integers in the range 0-255.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">thick_featuretype</span> <span class="ow">and</span> <span class="n">thin_featuretype</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Can only specify one of `thick_featuertype` or &quot;</span> <span class="s2">&quot;`thin_featuretype`&quot;</span>
            <span class="p">)</span>

        <span class="n">exons</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">featuretype</span><span class="o">=</span><span class="n">block_featuretype</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exons</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="p">]</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">exons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">exons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span>

        <span class="k">if</span> <span class="n">first</span> <span class="o">!=</span> <span class="n">feature</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Start of first exon (</span><span class="si">%s</span><span class="s2">) does not match start of feature (</span><span class="si">%s</span><span class="s2">)&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">feature</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">last</span> <span class="o">!=</span> <span class="n">feature</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;End of last exon (</span><span class="si">%s</span><span class="s2">) does not match end of feature (</span><span class="si">%s</span><span class="s2">)&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">feature</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;0,0,0&quot;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Use field names as defined at</span>
        <span class="c1"># http://genome.ucsc.edu/FAQ/FAQformat.html#format1</span>
        <span class="n">chrom</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">chrom</span>
        <span class="n">chromStart</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">chromEnd</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">stop</span>
        <span class="n">orig</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">always_return_list</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">always_return_list</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="n">name_field</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>

        <span class="n">constants</span><span class="o">.</span><span class="n">always_return_list</span> <span class="o">=</span> <span class="n">orig</span>

        <span class="n">score</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">score</span>
        <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
        <span class="n">strand</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">strand</span>
        <span class="n">itemRgb</span> <span class="o">=</span> <span class="n">color</span>
        <span class="n">blockCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exons</span><span class="p">)</span>
        <span class="n">blockSizes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">exons</span><span class="p">]</span>
        <span class="n">blockStarts</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">chromStart</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">exons</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">thick_featuretype</span><span class="p">:</span>
            <span class="n">thick</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">featuretype</span><span class="o">=</span><span class="n">thick_featuretype</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thick</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">thickStart</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">start</span>
                <span class="n">thickEnd</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">stop</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thickStart</span> <span class="o">=</span> <span class="n">thick</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># BED 0-based coords</span>
                <span class="n">thickEnd</span> <span class="o">=</span> <span class="n">thick</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span>

        <span class="k">if</span> <span class="n">thin_featuretype</span><span class="p">:</span>
            <span class="n">thin</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">featuretype</span><span class="o">=</span><span class="n">thin_featuretype</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thin</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">thickStart</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">start</span>
                <span class="n">thickEnd</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">stop</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thickStart</span> <span class="o">=</span> <span class="n">thin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span>
                <span class="n">thickEnd</span> <span class="o">=</span> <span class="n">thin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># BED 0-based coords</span>

        <span class="n">tst</span> <span class="o">=</span> <span class="n">chromStart</span> <span class="o">+</span> <span class="n">blockStarts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">blockSizes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">tst</span> <span class="o">==</span> <span class="n">chromEnd</span><span class="p">,</span> <span class="s2">&quot;tst=</span><span class="si">%s</span><span class="s2">; chromEnd=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tst</span><span class="p">,</span> <span class="n">chromEnd</span><span class="p">)</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">chrom</span><span class="p">,</span>
            <span class="n">chromStart</span><span class="p">,</span>
            <span class="n">chromEnd</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">score</span><span class="p">,</span>
            <span class="n">strand</span><span class="p">,</span>
            <span class="n">thickStart</span><span class="p">,</span>
            <span class="n">thickEnd</span><span class="p">,</span>
            <span class="n">itemRgb</span><span class="p">,</span>
            <span class="n">blockCount</span><span class="p">,</span>
            <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">blockSizes</span><span class="p">)),</span>
            <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">blockStarts</span><span class="p">)),</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">fields</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">seqids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yield the unique sequence IDs (chromosomes, contigs) observed in the</span>
<span class="sd">        database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            SELECT DISTINCT seqid from features</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>


    <span class="c1"># Recycle the docs for _relation so they stay consistent between parents()</span>
    <span class="c1"># and children()</span>
    <span class="n">children</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">children</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_relation_docstring</span><span class="o">=</span><span class="n">_relation</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">parents</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">parents</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_relation_docstring</span><span class="o">=</span><span class="n">_relation</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>

    <span class="c1"># Add the docs for methods that call helpers.make_query()</span>
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="n">parents</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="n">features_of_type</span><span class="p">,</span> <span class="n">all_features</span><span class="p">]:</span>
        <span class="n">method</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_method_doc</span><span class="o">=</span><span class="n">_method_doc</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2022, Ryan Dale.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>